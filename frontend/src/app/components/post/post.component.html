<div class="container my-4">
  <div class="mb-4">
    <h4 class="mb-3">Create a New Post</h4>
    <div class="input-group mb-2">
      <span class="input-group-text">Title</span>
      <input
        type="text"
        class="form-control"
        [(ngModel)]="newPost.title"
        placeholder="Enter title"
      />
    </div>
    <div class="input-group mb-3">
      <span class="input-group-text">Body</span>
      <input
        type="text"
        class="form-control"
        [(ngModel)]="newPost.body"
        placeholder="Enter body"
      />
    </div>
    <button class="btn btn-primary" (click)="addPost()">Add Post</button>
  </div>

  <div *ngFor="let post of posts" class="card mb-4 shadow-sm">
    <div class="card-body">
      <h5 class="card-title text-capitalize">{{ post.title }}</h5>
      <p class="card-text">{{ post.body }}</p>

      <div class="d-flex justify-content-between text-muted mb-2">
        <small><strong>By:</strong> {{ post.user.name }}</small>
        <small
          ><strong>Posted on:</strong>
          {{ post.createdAt | date : "medium" }}</small
        >
      </div>

      <div class="d-flex gap-3 align-items-center mb-3">
        <button
          class="btn btn-sm"
          [ngClass]="{
            'btn-outline-success': !post.liked,
            'btn-success text-white': post.liked
          }"
          (click)="likePost(post.id)"
        >
          <i
            class="bi bi-hand-thumbs-up-fill me-1"
            [style.color]="post.liked ? 'white' : 'green'"
          ></i>
          {{ post.likes }}
        </button>

        <button
          class="btn btn-sm"
          [ngClass]="{
            'btn-outline-danger': !post.disliked,
            'btn-danger text-white': post.disliked
          }"
          (click)="dislikePost(post.id)"
        >
          <i
            class="bi bi-hand-thumbs-down-fill me-1"
            [style.color]="post.disliked ? 'white' : 'red'"
          ></i>
          {{ post.dislikes }}
        </button>
      </div>

      <button
        class="btn btn-secondary btn-sm mb-2"
        (click)="toggleComments(post.id)"
      >
        {{ post.id === selectedPostId ? "Hide" : "Show" }} Comments
      </button>

      <div *ngIf="post.id === selectedPostId">
        <h6 class="text-secondary mt-3">Comments:</h6>
        <div *ngIf="post.comments.length === 0" class="text-muted mb-2">
          No Comments Yet
        </div>

        <ul
          class="list-group list-group-flush mb-3"
          *ngIf="post.comments.length > 0"
        >
          <li *ngFor="let comment of post.comments" class="list-group-item">
            <p class="mb-1">{{ comment.body }}</p>

            <div class="d-flex gap-2 align-items-center mb-2">
              <button
                class="btn btn-sm"
                [ngClass]="{
                  'btn-outline-success': !comment.liked,
                  'btn-success text-white': comment.liked
                }"
                (click)="likeComment(post.id, comment.id)"
              >
                <i
                  class="bi bi-hand-thumbs-up-fill me-1"
                  [style.color]="comment.liked ? 'white' : 'green'"
                ></i>
                {{ comment.likes }}
              </button>

              <button
                class="btn btn-sm"
                [ngClass]="{
                  'btn-outline-danger': !comment.disliked,
                  'btn-danger text-white': comment.disliked
                }"
                (click)="dislikeComment(post.id, comment.id)"
              >
                <i
                  class="bi bi-hand-thumbs-down-fill me-1"
                  [style.color]="comment.disliked ? 'white' : 'red'"
                ></i>
                {{ comment.dislikes }}
              </button>
            </div>

            <div class="d-flex justify-content-between text-muted">
              <small>â€” {{ comment.user.name }}</small>
              <small>{{ comment.createdAt | date : "short" }}</small>
            </div>
          </li>
        </ul>

        <div class="input-group mb-2">
          <input
            type="text"
            class="form-control"
            placeholder="Write a comment..."
            [(ngModel)]="comment.body"
          />
          <button class="btn btn-outline-primary" (click)="addComment(post.id)">
            Add
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
